var contextBarItem;!function(a){contextBarItem=function(b,c,d){this.name=b,this.rightOffsets={},this.leftOffsets={},this.height=c,this.color=d,this.elem=a('<div class="contextBar_item"><div class="name">'+this.name+"</div></div>"),this.leftEdgeElem=a('<div class="contextBar_itemLeftEdge"></div>'),this.rightEdgeElem=a('<div class="contextBar_itemRightEdge"></div>')},contextBarItem.prototype.setRightVertexOffset=function(a,b){this.rightOffsets[a]=b},contextBarItem.prototype.setLeftVertexOffset=function(a,b){this.leftOffsets[a]=b},contextBarItem.prototype.offsetElemTopLeft=function(a,b){this.setLeftVertexOffset(2*a,b)},contextBarItem.prototype.offsetElemBottomLeft=function(a,b){this.setLeftVertexOffset(2*a+1,b)},contextBarItem.prototype.offsetElemTopRight=function(a,b){this.setRightVertexOffset(2*a,b)},contextBarItem.prototype.offsetElemBottomRight=function(a,b){this.setRightVertexOffset(2*a+1,b)},contextBarItem.prototype.setRegion=function(a,b){this.regionLeft=a,this.regionRight=b,1==this.isAdded&&this.parentContextBar.update()},contextBarItem.prototype.setRegionAsElems=function(b){var c=[],d=[];return a.each(b,function(a,b){c.push(function(){return[Math.round(b.offset().left),Math.round(b.offset().top)]}.bind(b)),c.push(function(){return[Math.round(b.offset().left),Math.round(b.offset().top+b.outerHeight())]}.bind(b)),d.push(function(){return[Math.round(b.offset().left+b.outerWidth()),Math.round(b.offset().top)]}.bind(b)),d.push(function(){return[Math.round(b.offset().left+b.outerWidth()),Math.round(b.offset().top+b.outerHeight())]}.bind(b))}),this.setRegion(c,d)},contextBarItem.prototype.getRegionVertex=function(a,b){var c,d=0;"left"==a?(c=this.regionLeft,null!=this.leftOffsets[b]&&(d="function"==typeof this.leftOffsets[b]?this.leftOffsets[b]():this.leftOffsets[b])):(c=this.regionRight,null!=this.rightOffsets[b]&&(d="function"==typeof this.rightOffsets[b]?this.rightOffsets[b]():this.rightOffsets[b]));var e;return e="function"==typeof c[b]?c[b]():c[b],null==e?null:(e[0]+=d,e)},contextBarItem.prototype.getClosestVertexAbovePoint=function(b,c){var d,e=this;d="left"==b?this.regionLeft:this.regionRight;var f=-1,g=-1;return a.each(d,function(a,d){var h=e.getRegionVertex(b,a);Math.round(c)>=Math.round(h[1])&&(g==-1?(g=Math.round(h[1]),f=a):g<=Math.round(h[1])&&(g=h[1],f=a))}),f<0&&(f=0),f},contextBarItem.prototype.getXYRatioForYInRegion=function(a,b){var c;c="left"==a?this.regionLeft:this.regionRight;var d=this.getClosestVertexAbovePoint(a,b);if(d+1>=c.length)return 0;var e=this.getRegionVertex(a,d),f=this.getRegionVertex(a,d+1),g=f[0]-e[0],h=f[1]-e[1];return g/h},contextBarItem.prototype.getXForYInRegion=function(a,b){var c;c="left"==a?this.regionLeft:this.regionRight;var d=this.getClosestVertexAbovePoint(a,b),e=0;if(b==this.getRegionVertex(a,d)[1])e=this.getRegionVertex(a,d)[0];else{var f=this.getRegionVertex(a,d)[0],g=this.getRegionVertex(a,d)[1],h=this.getRegionVertex(a,d+1)[0],i=this.getRegionVertex(a,d+1)[1],j=b-g,k=i-g,l=j/k,m=(h-f)*l;e=f+m}return e}}(jQuery);var contextBar;!function(a){var b=Object.freeze({vertical:0,sidebyside:1});contextBar=function(a){this.elem=a,this.items=[],this.mode=b.sidebyside},contextBar.prototype.setModeVertical=function(){this.mode=b.vertical},contextBar.prototype.setModeSideBySide=function(){this.mode=b.sidebyside},contextBar.prototype.update=function(){if(this.mode==b.sidebyside){var c=this.elem.offset().top+this.elem.outerHeight();a.each(this.items,function(a,b){var d=0,e=0;c>b.getRegionVertex("left",b.regionLeft.length-1)[1]||c>b.getRegionVertex("right",b.regionRight.length-1)[1]?(d=0,e=0):(d=b.getXForYInRegion("left",c),e=b.getXForYInRegion("right",c)-d),b.elem.css("left",d),b.elem.css("width",e),0==e?b.elem.css("display","none"):b.elem.css("display","");var f=b.getXYRatioForYInRegion("left",c);if(f>0){b.leftEdgeElem.css("border-bottom",""),b.leftEdgeElem.css("border-top",b.height+" solid "+b.color);var g=parseInt(b.leftEdgeElem.css("border-top-width"),10)*f;b.leftEdgeElem.css("border-left",g+"px solid transparent"),b.leftEdgeElem.css("left",d-g),b.leftEdgeElem.css("width",e/2+g)}else{b.leftEdgeElem.css("border-top",""),b.leftEdgeElem.css("border-bottom",b.height+" solid "+b.color);var g=parseInt(b.leftEdgeElem.css("border-bottom-width"),10)*Math.abs(f);b.leftEdgeElem.css("border-left",g+"px solid transparent"),b.leftEdgeElem.css("left",d),b.leftEdgeElem.css("width",e/2),b.elem.css("left",d+g)}var h=b.getXYRatioForYInRegion("right",c);if(h>0){b.rightEdgeElem.css("border-top",""),b.rightEdgeElem.css("border-bottom",b.height+" solid "+b.color);var i=parseInt(b.rightEdgeElem.css("border-bottom-width"),10)*h;b.rightEdgeElem.css("border-right",i+"px solid transparent"),b.rightEdgeElem.css("left",d+e/2-i),b.rightEdgeElem.css("width",e/2+i)}else{b.rightEdgeElem.css("border-bottom",""),b.rightEdgeElem.css("border-top",b.height+" solid "+b.color);var i=parseInt(b.rightEdgeElem.css("border-top-width"),10)*Math.abs(h);b.rightEdgeElem.css("border-right",i+"px solid transparent"),b.rightEdgeElem.css("left",d+e/2),b.rightEdgeElem.css("width",e/2)}})}},contextBar.prototype.addItem=function(a){a.isAdded=1,a.parentContextBar=this,a.elem.appendTo(this.elem),a.elem.css("position","absolute"),a.elem.css("top",0),a.elem.css("z-index",2),a.leftEdgeElem.appendTo(this.elem),a.leftEdgeElem.css("position","absolute"),a.leftEdgeElem.css("z-index",1),a.leftEdgeElem.css("top",0),a.rightEdgeElem.appendTo(this.elem),a.rightEdgeElem.css("position","absolute"),a.rightEdgeElem.css("z-index",1),a.rightEdgeElem.css("top",0),this.items.push(a),this.update()},contextBar.prototype.removeItem=function(a){a.isAdded=0,a.parentContextBar=null,a.elem.remove(),this.update()},contextBar.prototype.destroy=function(){var b=this;a.each(this.items,function(a,c){b.removeItem(c)}),a(window).off("resize load scroll",this.update_func)};var c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,d=a(window),e=d.scrollTop();a.fn.initContextBar=function(){function b(){var a=d.scrollTop();return e===a?void c(b):(e=a,f.update_func(),c(b),void 0)}var f=new contextBar(this);return f.update_func=f.update.bind(f),f.update(),a(window).on("resize load",f.update_func),c&&b(),f}}(jQuery);