var contextBarItem;!function(a){contextBarItem=function(a,b,c){this.name=a,this.rightOffsets={},this.leftOffsets={},this.height=b,this.color=c},contextBarItem.prototype.setRightVertexOffset=function(a,b){this.rightOffsets[a]=b},contextBarItem.prototype.setLeftVertexOffset=function(a,b){this.leftOffsets[a]=b},contextBarItem.prototype.offsetElemTopLeft=function(a,b){this.setLeftVertexOffset(2*a,b)},contextBarItem.prototype.offsetElemBottomLeft=function(a,b){this.setLeftVertexOffset(2*a+1,b)},contextBarItem.prototype.offsetElemTopRight=function(a,b){this.setRightVertexOffset(2*a,b)},contextBarItem.prototype.offsetElemBottomRight=function(a,b){this.setRightVertexOffset(2*a+1,b)},contextBarItem.prototype.setRegion=function(a,b){this.regionLeft=a,this.regionRight=b,1==this.isAdded&&this.parentContextBar.update()},contextBarItem.prototype.setRegionAsElems=function(b){var c=[],d=[];return a.each(b,function(a,b){c.push(function(){return[b.offset().left,b.offset().top]}.bind(b)),c.push(function(){return[b.offset().left,b.offset().top+b.outerHeight()]}.bind(b)),d.push(function(){return[b.offset().left+b.outerWidth(),b.offset().top]}.bind(b)),d.push(function(){return[b.offset().left+b.outerWidth(),b.offset().top+b.outerHeight()]}.bind(b))}),this.setRegion(c,d)},contextBarItem.prototype.getRegionVertex=function(a,b){var c,d=0;"left"==a?(c=this.regionLeft,null!=this.leftOffsets[b]&&(d="function"==typeof this.leftOffsets[b]?this.leftOffsets[b]():this.leftOffsets[b])):(c=this.regionRight,null!=this.rightOffsets[b]&&(d="function"==typeof this.rightOffsets[b]?this.rightOffsets[b]():this.rightOffsets[b]));var e;return e="function"==typeof c[b]?c[b]():c[b],null==e?null:(e[0]+=d,e)},contextBarItem.prototype.getClosestVertexAbovePoint=function(b,c){var d,e=this;d="left"==b?this.regionLeft:this.regionRight;var f=-1,g=-1;return a.each(d,function(a,d){var h=e.getRegionVertex(b,a);c>=h[1]&&(g==-1?(g=h[1],f=a):g<=h[1]&&(g=h[1],f=a))}),f<0&&(f=0),f},contextBarItem.prototype.getXYRatioForYInRegion=function(a,b){var c;c="left"==a?this.regionLeft:this.regionRight;var d=this.getClosestVertexAbovePoint(a,b);if(d+1>=c.length)return 0;var e=this.getRegionVertex(a,d),f=this.getRegionVertex(a,d+1),g=f[0]-e[0],h=f[1]-e[1];return g/h},contextBarItem.prototype.getXForYInRegion=function(a,b){var c;c="left"==a?this.regionLeft:this.regionRight;var d=this.getClosestVertexAbovePoint(a,b),e=0;if(b==this.getRegionVertex(a,d)[1])e=this.getRegionVertex(a,d)[0];else{var f=this.getRegionVertex(a,d)[0],g=this.getRegionVertex(a,d)[1],h=this.getRegionVertex(a,d+1)[0],i=this.getRegionVertex(a,d+1)[1],j=b-g,k=i-g,l=j/k,m=(h-f)*l;e=f+m}return e}}(jQuery);var contextBar;!function(a){contextBar=function(a){this.elem=a,this.items=[]},contextBar.prototype.update=function(){var b=this.elem.offset().top+this.elem.height();a.each(this.items,function(a,c){var d=0,e=0;b>c.getRegionVertex("left",c.regionLeft.length-1)[1]||b>c.getRegionVertex("right",c.regionRight.length-1)[1]?(d=0,e=0):(d=c.getXForYInRegion("left",b),e=c.getXForYInRegion("right",b)-d),c.elem.css("left",d),c.elem.css("width",e),0==e?c.elem.css("display","none"):c.elem.css("display","");var f=0;c.leftEdgeElem.css("width",e/2),c.rightEdgeElem.css("width",e/2);var g=c.getXYRatioForYInRegion("left",b);if(g>0){c.leftEdgeElem.css("border-bottom",""),c.leftEdgeElem.css("border-top",c.height+" solid "+c.color);var h=parseInt(c.leftEdgeElem.css("border-top-width"),10)*g;c.leftEdgeElem.css("border-left",h+"px solid transparent"),c.leftEdgeElem.css("left",d-h)}else{c.leftEdgeElem.css("border-top",""),c.leftEdgeElem.css("border-bottom",c.height+" solid "+c.color);var h=parseInt(c.leftEdgeElem.css("border-bottom-width"),10)*Math.abs(g);c.leftEdgeElem.css("border-left",h+"px solid transparent"),c.leftEdgeElem.css("left",d),c.elem.css("left",d+h),f+=h}var i=c.getXYRatioForYInRegion("right",b);if(i>0){c.rightEdgeElem.css("border-top",""),c.rightEdgeElem.css("border-bottom",c.height+" solid "+c.color);var j=parseInt(c.rightEdgeElem.css("border-bottom-width"),10)*i;c.rightEdgeElem.css("border-right",j+"px solid transparent"),c.rightEdgeElem.css("left",d+e/2-j),f+=j}else{c.rightEdgeElem.css("border-bottom",""),c.rightEdgeElem.css("border-top",c.height+" solid "+c.color);var j=parseInt(c.rightEdgeElem.css("border-top-width"),10)*Math.abs(i);c.rightEdgeElem.css("border-right",j+"px solid transparent"),c.rightEdgeElem.css("left",d+e/2)}c.elem.css("width",e-f)})},contextBar.prototype.addItem=function(b){b.isAdded=1,b.parentContextBar=this,b.elem=a('<div class="contextBar_item"><div class="name">'+b.name+"</div></div>").appendTo(this.elem),b.elem.css("position","absolute"),b.elem.css("top",0),b.elem.css("z-index",2),b.leftEdgeElem=a('<div class="contextBar_itemLeftEdge"></div>').appendTo(this.elem),b.leftEdgeElem.css("position","absolute"),b.leftEdgeElem.css("z-index",1),b.leftEdgeElem.css("top",0),b.rightEdgeElem=a('<div class="contextBar_itemRightEdge"></div>').appendTo(this.elem),b.rightEdgeElem.css("position","absolute"),b.rightEdgeElem.css("z-index",1),b.rightEdgeElem.css("top",0),this.items.push(b),this.update()},contextBar.prototype.removeItem=function(a){a.isAdded=0,a.parentContextBar=null,a.elem.remove(),this.update()},contextBar.prototype.destroy=function(){var b=this;a.each(this.items,function(a,c){b.removeItem(c)}),a(window).off("resize load scroll",this.update_func)},a.fn.initContextBar=function(){var b=new contextBar(this);return b.update_func=b.update.bind(b),b.update(),a(window).on("resize load scroll",b.update_func),b}}(jQuery);